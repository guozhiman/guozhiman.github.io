<?php @set_time_limit(0);define('XQ_ADMIN', true);require 'global.php';$session = new dsession();XQcms::load_xq_func('admin');XQcms::load_xq_func('cache');XQcms::load_xq_func('post');isset($file) or $file = 'index';$_userid= isset($_SESSION['xqcms_admin']) ? intval($_SESSION['xqcms_admin']) : 0;$_admin= isset($_SESSION['admin']) ? intval($_SESSION['admin']) : 0;$_username=isset($_SESSION['username']) ? $_SESSION['username'] : '';$_founder = $WEB['founders'] == $_userid ? $_userid : 0;$_catids = $_childs = '';$_catid = $_child = array();if($file != 'login') {if(!$_userid) msg('', '?file=login&forward='.urlencode($XQ_URL));if(!power()) {$db->query("DELETE FROM {$db->pre}power WHERE userid=$_userid AND url='?".$XQ_QST."'");msg(lang('message->no_power'));}}if(isset($post['catid'])) $catid = $post['catid'];$psize = isset($psize) ? intval($psize) : 0;if($psize > 0 && $psize != $pagesize) {$pagesize = $psize;$offset = ($page-1)*$pagesize;}if($module == 'xqcms') {(@include XQ_SYSROOT.'/controllers/admin/'.$file.'.inc.php') or msg();} else {require XQ_SYSROOT.'/controllers/'.$module.'/common.inc.php';if($_catids) {$_catid = explode(',', $_catids);foreach($CATEGORY as $k=>$c) {if($c['parentid'] > 0) continue;if(!in_array($k, $_catid)) unset($CATEGORY[$k]);}foreach($_catid as $t) {$_childs .= ','.($CATEGORY[$t]['child'] ? $CATEGORY[$t]['arrchildid'] : $t);}if($_childs) {$_childs = substr($_childs, 1);$_child = explode(',', $_childs);if(isset($post['catid']) && $post['catid'] && !in_array($post['catid'], $_child)) msg(lang('message->no_power'));if($id) {if(is_array($id)) {foreach($id as $_id) {item_check($_id) or msg(lang('message->no_power'));}} else {item_check($id) or msg(lang('message->no_power'));}}}}(@include XQ_SYSROOT.'/controllers/'.$module.'/admin/'.$file.'.inc.php') or msg();}?>