<?php defined('IN_XQCMS') or exit('Access Denied');$menus = array (array('系统首页'),);switch($action) {case 'cache':isset($step) or $step = 0;if($step == 1) {cache_clear('module');cache_module();msg('系统设置更新成功', '?action='.$action.'&step='.($step+1));} else if($step == 2) {cache_clear('php', 'dir', 'tpl');msg('模板缓存更新成功', '?action='.$action.'&step='.($step+1));} else if($step == 3) {cache_clear('cat');cache_category();msg('分类缓存更新成功', '?action='.$action.'&step='.($step+1));} else if($step == 4) {cache_clear_ad();tohtml('index');msg('网站首页更新成功', '?action='.$action.'&step='.($step+1));} else if($step == 5) {cache_clear('type');cache_type();msg('全部缓存更新成功');} else {msg('正在开始更新缓存', '?action='.$action.'&step='.($step+1));}break;case 'html':tohtml('index');$filename = XQ_ROOT.'/'.$XQ['index'].'.'.$XQ['file_ext'];msg('首页更新成功 '.(is_file($filename) ? dround(filesize($filename)/1024).'Kb ' : '').'&nbsp;&nbsp;<a href="'.XQ_PATH.'" target="_blank">点击查看</a>');break;case 'phpinfo':phpinfo();break;case 'side':include tpl('side');break;case 'main':$install = file_get(XQ_CACHE.'/install.lock');if(!$install) {$install = $XQ_TIME;file_put(XQ_CACHE.'/install.lock', $XQ_TIME);}$install = timetodate($install, 5);include tpl('main');break;case 'counter':$today = strtotime(timetodate($XQ_TIME, 3).' 00:00:00');$num = $db->count($XQ_PRE.'guestbook', "1");echo '$("#guestbook").html("'.$num.'");';$num = $db->count($XQ_PRE.'guestbook', "edittime=0");$num = $num ? '<strong class=\"f_red\">'.$num.'</strong>' : 0;echo '$("#guestbook_1").html("'.$num.'");';$num = $db->count($XQ_PRE.'link', "status=2");$num = $num ? '<strong class=\"f_red\">'.$num.'</strong>' : 0;echo '$("#link").html("'.$num.'");';foreach($MODULE as $m) {if($m['moduleid'] < 5 || $m['islink']) continue;$table = get_table($m['moduleid']);$num = $db->count($table, '1');echo '$("#m_'.$m['moduleid'].'").html("'.$num.'");';$num = $db->count($table, "status=2");$num = $num ? '<strong class=\"f_red\">'.$num.'</strong>' : 0;echo '$("#m_'.$m['moduleid'].'_2").html("'.$num.'");';$num = $db->count($table, "addtime>$today");echo '$("#m_'.$m['moduleid'].'_3").html("'.$num.'");';}break;case 'top':$user = $db->get_one("SELECT * FROM {$XQ_PRE}users WHERE userid=$_userid");include tpl('top');break;case 'left':$mymenu = cache_read('menu-'.$_userid.'.php');include tpl('left');break;default:include tpl('index');break;}?>