<?php defined('IN_XQCMS') or exit('Access Denied');class dtype {public$item;private $db;private $table;public $cache = 0;public function dtype() {global $db;$this->db = &$db;$this->table = $this->db->pre.'type';}public function flist() {$lists = array();$result = $this->db->query("SELECT * FROM {$this->table} WHERE item='$this->item' ORDER BY listorder ASC,tid DESC ");while($r = $this->db->fetch_array($result)) {$lists[] = $r;}return $lists;}public function update($post) {$this->add($post[0]);unset($post[0]);foreach($post as $k=>$v) {if(isset($v['delete'])) {$this->delete($k);unset($post[$k]);}}$this->edit($post);if($this->cache) cache_type($this->item);return true;}private function add($post) {if(!$post['name']) return false;$post['listorder'] = intval($post['listorder']);$this->db->query("INSERT INTO {$this->table} (listorder,name,color,item,cache) VALUES('$post[listorder]','$post[name]','$post[color]','$this->item','$this->cache')");}private function edit($post) {foreach($post as $k=>$v) {if(!$v['name']) continue;$v['listorder'] = intval($v['listorder']);$this->db->query("UPDATE {$this->table} SET listorder='$v[listorder]',name='$v[name]',color='$v[color]' WHERE tid='$k' AND item='$this->item'");}}private function delete($tid) {$this->db->query("DELETE FROM {$this->table} WHERE tid=$tid AND item='$this->item'");if($this->cache) cache_type($this->item);}}?>