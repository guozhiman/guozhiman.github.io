<?php defined('IN_XQCMS') or exit('Access Denied');function timetodate($time = 0, $type = 6) {if(!$time) {global $XQ_TIME; $time = $XQ_TIME;}$types = array('Y-m-d', 'Y', 'm-d', 'Y-m-d', 'm-d H:i', 'Y-m-d H:i', 'Y-m-d H:i:s');if(isset($types[$type])) $type = $types[$type];return date($type, $time);}function msg($msg = errmsg, $forward = 'goback', $time = '1') {global $WEB;if(!$msg && $forward && $forward != 'goback') {dheader($forward);}include XQ_SYSROOT.'/controllers/admin/templates/msg.tpl.php';exit;}function dialog($dcontent) {global $WEB;include XQ_SYSROOT.'/controllers/admin/templates/dialog.tpl.php';exit;}function tpl($file = 'index', $mod = 'xiqiao') {global $WEB, $XQ;return $mod == 'xiqiao' ? XQ_SYSROOT.'/controllers/admin/templates/'.$file.'.tpl.php' : XQ_SYSROOT.'/controllers/'.$mod.'/admin/templates/'.$file.'.tpl.php';}function progress($sid, $fid, $tid,$p) {$allwidth=316;if($tid <= $sid || $tid<=$fid){$p = $allwidth;}else{$p = dround(($fid-$sid)*100/($tid-$sid), 0, true);if($p > 100) $p = 100;$p = $p/100*$allwidth;}return '<script>$(function() {$("#progress").each(function() {$(this).animate({width: '.$p.'}, 400);});});</script><table cellpadding="0" cellspacing="0" width="100%" style="margin:0"><tr><td><div class="progress"><div id="progress" style="width:'.($_GET['p']?$_GET['p']:0).'px"></div></div></td><td style="color:#666666;font-size:10px;width:40px;text-align:center;">'.$p*100/$allwidth.'%</td></tr></table>';}function posmenu($menus = array()) {global $module, $file, $action;$menu = '';foreach($menus as $id=>$m) {if(isset($m[1])) {$extend = isset($m[2]) ? 'onclick="if('.$m[2].'){MP(\''.$m[1].'\');return false;}"' : 'onclick="MP(\''.$m[1].'\');return false;"';$menu .= '<td id="Tab'.$id.'" class="tab"><a href="javascript:void(0);" '.$extend.' >'.$m[0].'</a></td><td width="10">&nbsp;</td>';} else {$class = $id == 0 ? 'tab_on' : 'tab';$menu .= '<td id="Tab'.$id.'" class="'.$class.'"><a href="javascript:Tab('.$id.');">'.$m[0].'</a></td><td width="10">&nbsp;</td>';}}include XQ_SYSROOT.'/controllers/admin/templates/menu.tpl.php';;}function update_setting($mid, $setting) {global $db;$db->query("DELETE FROM {$db->pre}config WHERE mid='$mid'");foreach($setting as $k=>$v) {if(is_array($v)) $v = implode(',', $v);$db->query("INSERT INTO {$db->pre}config (mid,name,value) VALUES ('$mid','$k','$v')");}return true;}function get_setting($mid) {global $db;$setting = array();$query = $db->query("SELECT * FROM {$db->pre}config WHERE mid='$mid'");while($r = $db->fetch_array($query)) {$setting[$r['name']] = $r['value'];}return $setting;}function update_category($moduleid, $catid, $category = array(), $mod = array()) {global $db, $XQ;$mod or $mod = cache_read('module-'.$moduleid.'.php');$category or $category = cache_read('category-'.$moduleid.'.php');$url = listurl($moduleid, $catid, 0, $category, $mod);if($XQ['index']) $url = str_replace($XQ['index'].'.'.$XQ['file_ext'], '', $url);$db->query("UPDATE {$db->pre}category SET url='$url' WHERE catid=$catid");}function tips($tips) {echo ' <img src="data/style/help.png" width="11" height="11" title="'.$tips.'" alt="tips" class="c_p" onclick="Dconfirm(this.title, \'\', 450);" />';}function power() {global $WEB, $db, $_admin, $_userid, $moduleid, $file, $action, $catid, $_catids, $_childs;if(in_array($file, array('logout', 'xiqiao', 'mymenu'))) return true;if($moduleid == 1 && $file == 'index') return true;if($WEB['founders'] && $WEB['founders'] == $_userid) return true;if($_admin == 2) {$R = cache_read('right-'.$_userid.'.php');if(!$R) return false;if(!isset($R[$moduleid])) return false;if(!$R[$moduleid]) return true;if(!isset($R[$moduleid][$file])) return false;if(!$R[$moduleid][$file]) return true;if($action && $R[$moduleid][$file]['action'] && !in_array($action, $R[$moduleid][$file]['action'])) return false;if(!$R[$moduleid][$file]['catid']) return true;$_catids = implode(',', $R[$moduleid][$file]['catid']);if($catid) {if(in_array($catid, $R[$moduleid][$file]['catid'])) return true;$result = $db->query("SELECT catid,child,arrchildid FROM {$db->pre}category WHERE moduleid=$moduleid AND catid IN ($_catids)");while($r = $db->fetch_array($result)) {$_childs .= ','.($r['child'] ? $r['arrchildid'] : $r['catid']);}if(strpos($_childs.',', ','.$catid.',') !== false) return true;return false;}} else if($_admin == 1) {if(in_array($file, array('config', 'module', 'fields'))) return false;}return true;}function item_check($id) {global $db, $table, $_child;$r = $db->get_one("SELECT catid FROM {$table} WHERE id=$id");if($r && $_child && in_array($r['catid'], $_child)) return true;return false;}function seo_title($title, $show = '') {$SEO = array('modulename'	=>	'模块名称','page'=>	'页码','delimiter'=>	'分隔符','sitename'=>	'网站名称','sitetitle'=>	'网站SEO标题','catname'=>	'分类名称','cattitle'=>	'分类SEO标题','showtitle'=>	'内容标题',);if(is_array($show)) {foreach($show as $v) {if(isset($SEO[$v])) echo '<a href="javascript:_into(\''.$title.'\', \'{'.$SEO[$v].'}\');" title="{'.$SEO[$v].'}">{'.$SEO[$v].'}</a>&nbsp;&nbsp;';}} else {foreach($SEO as $k=>$v) {$title = str_replace($v, '$seo_'.$k, $title);}return $title;}}function steup_file($file, $dir, $extend = 0) {$content = "<?php\n";if($extend == 1) $content .= "define('XQ_REWRITE', true);\n";$content .= "require 'config.inc.php';\n";$content .= "require '../global.php';\n";$content .= "require XQ_SYSROOT.'/controllers/'.\$module.'/".$file.".inc.php';\n";$content .= '?>';return file_put(XQ_ROOT.'/'.$dir.'/'.$file.'.php', $content);}function list_dir($dir) {$dirs = array();$files = glob(XQ_ROOT.'/'.$dir.'/*');if(is_array($files)) {include XQ_ROOT.'/'.$dir.'/these.name.php';foreach($files as $v) {if(is_file($v)) continue;$v = basename($v);$n = isset($names[$v]) ? $names[$v] : $v;$dirs[] = array('dir'=>$v, 'name'=>$n);}}return $dirs;}function get_file($dir, $ext = '', $fs = array()) {$files = glob($dir.'/*');if(!is_array($files)) return $fs;foreach($files as $file) {if(is_dir($file)) {if(is_file($file.'/index.php') && is_file($file.'/config.inc.php')) continue;$fs = get_file($file, $ext, $fs);} else {if($ext) {if(preg_match("/\.($ext)$/i", $file)) $fs[] = $file;} else {$fs[] = $file;}}}return $fs;}function ext_select($name, $value, $extend = '') {include XQ_ROOT.'/app/filetype.php';$value or $value = 'oth';$select = '<select name="'.$name.'" '.$extend.'>';foreach($FILETYPE as $k=>$v) {$select .= '<option value="'.$k.'"'.($k == $value ? ' selected' : '').'>'.$v.'</option>';}$select .= '</select>';return $select;}function unit_select($name, $value, $extend = '') {$UNIT = array('K', 'M', 'G', 'T');$value or $value = 'M';$select = '<select name="'.$name.'" '.$extend.'>';foreach($UNIT as $k=>$v) {$select .= '<option value="'.$v.'"'.($v == $value ? ' selected' : '').'>'.$v.'</option>';}$select .= '</select>';return $select;}function login() {global $_userid;if(!$_userid) msg();}?>